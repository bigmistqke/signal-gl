import{e as T,m as E,w as z,K as Ae,a as w,x as G,b as R,y as ce,h as C,L as Me,f as Z,S as Se,n as Fe,s as _e,c as Pe,D as Le,C as Ce,t as Be,p as fe}from"./web-0901fd59.js";import{g as F,c as De,t as Ue}from"./index-cb1a4aba.js";import{c as Ne}from"./store-1bd1f121.js";import{A,E as ze,c as p,m as U,i as N,a as Ge,f as Ie,g as $e,t as Oe,r as q,s as qe,b as Xe,p as He,l as We}from"./mat4-bfe45697.js";function je(){var e=new A(9);return A!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function b(){var e=new A(3);return A!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Ye(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function K(e,t,n){var r=new A(3);return r[0]=e,r[1]=t,r[2]=n,r}function D(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function L(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function ie(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Ve(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function I(e,t){var n=t[0],r=t[1],i=t[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function Ke(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function X(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],a=n[1],c=n[2];return e[0]=i*c-s*a,e[1]=s*o-r*c,e[2]=r*a-i*o,e}function Q(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,e[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,e[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,e[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,e}function H(e,t,n){var r=n[0],i=n[1],s=n[2],o=n[3],a=t[0],c=t[1],f=t[2],d=i*f-s*c,l=s*a-r*f,v=r*c-i*a,h=i*v-s*l,u=s*d-r*v,g=r*l-i*d,m=o*2;return d*=m,l*=m,v*=m,h*=2,u*=2,g*=2,e[0]=a+d+h,e[1]=c+l+u,e[2]=f+v+g,e}var Qe=Ye;(function(){var e=b();return function(t,n,r,i,s,o){var a,c;for(n||(n=3),r||(r=0),i?c=Math.min(i*n+r,t.length):c=t.length,a=r;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],s(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}})();function Je(){var e=new A(4);return A!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ze(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=r*o,e[2]=i*o,e[3]=s*o,e}(function(){var e=Je();return function(t,n,r,i,s,o){var a,c;for(n||(n=4),r||(r=0),i?c=Math.min(i*n+r,t.length):c=t.length,a=r;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],s(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}})();function M(){var e=new A(4);return A!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function W(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function J(e,t,n){n=n*.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function j(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],a=n[0],c=n[1],f=n[2],d=n[3];return e[0]=r*d+o*a+i*f-s*c,e[1]=i*d+o*c+s*a-r*f,e[2]=s*d+o*f+r*c-i*a,e[3]=o*d-r*a-i*c-s*f,e}function Y(e,t,n,r){var i=t[0],s=t[1],o=t[2],a=t[3],c=n[0],f=n[1],d=n[2],l=n[3],v,h,u,g,m;return h=i*c+s*f+o*d+a*l,h<0&&(h=-h,c=-c,f=-f,d=-d,l=-l),1-h>ze?(v=Math.acos(h),u=Math.sin(v),g=Math.sin((1-r)*v)/u,m=Math.sin(r*v)/u):(g=1-r,m=r),e[0]=g*i+m*c,e[1]=g*s+m*f,e[2]=g*o+m*d,e[3]=g*a+m*l,e}function ke(e,t){var n=t[0]+t[4]+t[8],r;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var s=(i+1)%3,o=(i+2)%3;r=Math.sqrt(t[i*3+i]-t[s*3+s]-t[o*3+o]+1),e[i]=.5*r,r=.5/r,e[3]=(t[s*3+o]-t[o*3+s])*r,e[s]=(t[s*3+i]+t[i*3+s])*r,e[o]=(t[o*3+i]+t[i*3+o])*r}return e}var k=Ze;(function(){var e=b(),t=K(1,0,0),n=K(0,1,0);return function(r,i,s){var o=Ke(i,s);return o<-.999999?(X(e,t,i),Qe(e)<1e-6&&X(e,n,i),I(e,e),J(r,e,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(X(e,i,s),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+o,k(r,r))}})();(function(){var e=M(),t=M();return function(n,r,i,s,o,a){return Y(e,r,o,a),Y(t,i,s,a),Y(n,e,t,2*a*(1-a)),n}})();(function(){var e=je();return function(t,n,r,i){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],k(t,ke(t,e))}})();const et=Be("<canvas>");var tt=({cursor:e,projection:t,view:n})=>{const r=b(),i=p();return U(i,t,n),N(i,i),Q(r,[...e,1],i),I(r,r)},ue=G(),de=()=>z(ue),Ft=e=>{const[t,n]=T(new Set);return R(ue.Provider,{value:{get colliders(){return t()},addCollider:r=>(n(i=>i.add(r)),()=>ce(()=>t().delete(r)))},get children(){return[w(()=>(()=>(C(Me(()=>e.plugins||[],r=>r.initialize())),null))()),w(()=>e.children)]}})},_t=()=>{const[e,t]=T(new Set),[n,r]=T(),i=[0,0],s=(o,a)=>{const c=e();if(c)for(const f of c)f.intersects(o,a)?f.onEvent?.({type:"raycast",hit:!0}):f.onEvent?.({type:"raycast",hit:!1})};return{initialize(){const o=_(),a=de();if(!o)throw"scene is undefined";if(!a)throw"colliders is undefined";r(o),t(a.colliders),o.canvas.addEventListener("mousemove",c=>{i[0]=2*c.clientX/o.canvas.width-1,i[1]=1-2*c.clientY/o.canvas.height})},cast:s,castCenter(){const o=e(),a=n();if(!o||!a)return;const c=a.view.matrix,f=K(-c[2],-c[6],-c[10]);I(f,f);const d=Q(b(),[0,0,0],a.view.invertedMatrix);s(d,f)},castCursor(){const o=n();if(!o)return;const a=tt({cursor:i,projection:o.projection.matrix,view:o.view.matrix}),c=Q(b(),[0,0,0],o.view.invertedMatrix);s(c,a)}}},Pt=e=>{const t=_();if(!t)throw"scene undefined";const n=de();if(!n)throw"collidersContext undefined";const r=E({scale:[1,1,1],position:[0,0,0]},e),i=[0,0,0],s=[0,0,0];let o=[0,0,0],a=[0,0,0];const c=n.addCollider({intersects:(f,d)=>{for(let u=0;u<3;u++)o[u]=r.position[u]-.5*r.scale[u],a[u]=r.position[u]+.5*r.scale[u];const l=$e(b(),t.model.matrix);L(a,a,l),L(o,o,l);for(let u=0;u<3;u++){const g=1/d[u],m=(o[u]-f[u])*g,x=(a[u]-f[u])*g;i[u]=Math.min(m,x),s[u]=Math.max(m,x)}const v=Math.max(i[0],i[1],i[2]),h=Math.min(s[0],s[1],s[2]);return!(v>h||h<0)},get onEvent(){return e.onEvent}});return Z(c),[R(Se,{get when(){return e.color},get children(){return R(Tt,{get mode(){return e.mode||"LINES"},get color(){return e.color}})}}),R(te,E(r,{get children(){return e.children}}))]},le=e=>typeof e=="object"&&Array.isArray(e)?e:[e];function rt(e,t,n){const r=e.createProgram();var i=se(e,t,"vertex"),s=se(e,n,"fragment");return!r||!i||!s?null:(e.attachShader(r,i),e.attachShader(r,s),e.deleteShader(i),e.deleteShader(s),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)?r:(console.error("error while creating program",e.getProgramInfoLog(r)),e.deleteProgram(r),null))}function se(e,t,n){const r=e.createShader(n==="fragment"?e.FRAGMENT_SHADER:e.VERTEX_SHADER);return r?(e.shaderSource(r,t),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(console.error(n,e.getShaderInfoLog(r)),e.deleteShader(r),null)):(console.error(n,"error while creating shader"),null)}var nt=({token:e,gl:t,program:n,addToRenderQueue:r})=>{const i=t.getUniformLocation(n,e.name),o=e.dataType.includes("mat")?()=>t[e.functionName](i,!1,e.value):()=>t[e.functionName](i,e.value);r(e.name,o)},it=({token:e,gl:t,program:n,addToRenderQueue:r,requestRender:i})=>{const s=t.getAttribLocation(n,e.name);he({token:e.buffer,gl:t,addToRenderQueue:r,requestRender:i,cb:()=>{t.enableVertexAttribArray(s),t.vertexAttribPointer(s,e.size,t.FLOAT,!1,e.options.stride,e.options.offset)}})},he=({token:e,gl:t,addToRenderQueue:n,requestRender:r,cb:i})=>{const s=t.createBuffer();n(e.name,()=>{t.bindBuffer(t[e.options.target],s),i?.(s)}),fe(()=>{t.bindBuffer(t[e.options.target],s),t.bufferData(t[e.options.target],e.value,t.STATIC_DRAW),t.finish(),r()})},st=({token:e,gl:t,program:n,addToRenderQueue:r,requestRender:i})=>{const s=c=>c instanceof vt,o=t.createTexture(),a=()=>s(e.value)?e.value.texture:o;r(e.name,()=>{t.activeTexture(t[`TEXTURE${e.textureIndex}`]),t.bindTexture(t.TEXTURE_2D,a())}),fe(()=>{t.useProgram(n);const{format:c,width:f,height:d,border:l,minFilter:v,magFilter:h,wrapS:u,wrapT:g,internalFormat:m,dataType:x}=e.options;t.activeTexture(t[`TEXTURE${e.textureIndex}`]),t.bindTexture(t.TEXTURE_2D,a()),ce(()=>s(e.value))||t.texImage2D(t.TEXTURE_2D,0,t[m],f,d,l,t[c],t[x],e.value),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[v]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[h]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t[u]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t[g]),t.uniform1i(t.getUniformLocation(n,e.name),e.textureIndex),i()})},ae=e=>{switch(e){case"float":return"uniform1f";case"int":case"bool":return"uniform1i";default:e.includes("mat");const t=e[e.length-1];if(e.includes("mat"))return`uniformMatrix${t}fv`;const n=e[0]==="b"||e[0]==="i"?"i":"f";return`uniform${t}${n}v`}},at=0,S=new Proxy({},{get(e,t){return(...[n,r])=>t==="sampler2D"?{dataType:t,name:"u_"+F(),functionName:ae(t),tokenType:t,get value(){return typeof n=="function"?n():n},options:E({border:0,dataType:"UNSIGNED_BYTE",format:"RGBA",height:2,internalFormat:"RGBA8",magFilter:"NEAREST",minFilter:"NEAREST",width:2,wrapS:"CLAMP_TO_EDGE",wrapT:"CLAMP_TO_EDGE"},r),textureIndex:at++}:{dataType:t,functionName:ae(t),get value(){return typeof n=="function"?n():n},name:"u_"+F(),options:r,tokenType:"uniform"}}}),ot=new Proxy({},{get(e,t){return(...[n,r])=>{const i=E({stride:0,offset:0},r),s=typeof t=="string"?+t[t.length-1]:void 0;return{buffer:ve(n,{target:"ARRAY_BUFFER"}),dataType:t,name:"a_"+F(),options:i,size:s&&!isNaN(s)?s:1,tokenType:"attribute"}}}}),ve=(e,t)=>({name:t.name||F(),tokenType:"buffer",get value(){return typeof e=="function"?e():e},options:t}),me=class{gl;canvas;config;constructor(e){const t=E({background:[0,0,0,1]},e);this.config=t,this.canvas=t.canvas;const n=t.canvas.getContext("webgl2");if(!n)throw"can not get webgl2 context";this.gl=n,this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.gl.depthRange(.2,10),this.gl.clearDepth(1)}render(){return this}clear(){return this.gl.clearColor(...this.config.background),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.depthMask(!0),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this}autosize(e){if(this.canvas instanceof OffscreenCanvas)throw"can not autosize OffscreenCanvas";return new ResizeObserver(()=>{if(this.canvas instanceof OffscreenCanvas)throw"can not autosize OffscreenCanvas";this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.clear(),this.render(),e?.(this)}).observe(this.canvas),this}read(e,t){const n={format:"RGBA",dataType:"UNSIGNED_BYTE",internalFormat:"RGBA8",width:this.gl.canvas.width,height:this.gl.canvas.height,...t};return this.render().gl.readPixels(0,0,n.width,n.height,this.gl[n.format],this.gl[n.dataType],e),e}},ge=class extends me{config;program;constructor(e){super(e);const t=E({mode:"TRIANGLES",cacheEnabled:!1,first:0,offset:0},e);if(this.config=t,!this.gl)throw"webgl2 is not supported";const r=t.cacheEnabled&&ut(t)||rt(this.gl,t.vertex.source.code,t.fragment.source.code);if(!r)throw"error while building program";if(this.program=r,t.cacheEnabled&&dt({...t,program:this.program}),t.vertex.bind(this),t.fragment.bind(this),"indices"in t&&t.indices){const i=ve(Array.isArray(t.indices)?new Uint16Array(t.indices):t.indices,{target:"ELEMENT_ARRAY_BUFFER"});he(E(this,{token:i}))}}renderQueue=new Map;addToRenderQueue=(e,t)=>(this.renderQueue.set(e,t),()=>this.renderQueue.delete(e));renderRequestSignal=T(0);getRenderRequest=this.renderRequestSignal[0];setRenderRequest=this.renderRequestSignal[1];requestRender=()=>{this.setRenderRequest(e=>(e+1)%1e8)};render=()=>{this.getRenderRequest(),this.gl.useProgram(this.program);const e=this.renderQueue.values();for(const t of e)t();return this.config.onRender?.(this.gl,this.program),"indices"in this.config&&this.config.indices?this.gl.drawElements(this.gl[this.config.mode||"TRIANGLES"],this.config.indices.length,this.gl.UNSIGNED_SHORT,this.config.offset||0):"count"in this.config?this.gl.drawArrays(this.gl[this.config.mode||"TRIANGLES"],this.config.first||0,this.config.count):console.error("neither indices nor count defined"),this}},Ee=e=>e instanceof ge,ct=e=>le(e).filter(Ee),ft=e=>le(e).filter(t=>!Ee(t)),P=new WeakMap,ut=e=>P.get(e.vertex.template)?.get(e.fragment.template),dt=({vertex:e,fragment:t,program:n})=>{P.get(e.template)||P.set(e.template,new WeakMap),P.get(e.template).get(t.template)||P.get(e.template).set(t.template,n)},lt=class extends me{config;get programs(){return this.config.programs}constructor(e){super(e),this.config=e}render(){const e=this.programs;for(const t of e)t.render();return this}},Re=class{gl;config;constructor(e,t){this.gl=e,this.config=t||{}}},ht=class extends Re{texture;constructor(e,t={}){super(e,t);const n=this.gl.createTexture();if(!n)throw"unable to create texture";this.texture=n}},vt=class extends ht{renderBuffer;constructor(e,t={}){super(e,t),this.renderBuffer=new mt(e,t)}activate(){this.renderBuffer.activate(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl[this.config.internalFormat||"RGBA8"],this.gl.drawingBufferWidth,this.gl.drawingBufferHeight,0,this.gl[this.config.format||"RGBA"],this.gl[this.config.dataType||"UNSIGNED_BYTE"],null),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.texture,0)}deactivate(){this.renderBuffer.deactivate()}},mt=class extends Re{framebuffer;depthbuffer;colorbuffer;constructor(e,t={}){super(e,t);const n=e.createFramebuffer(),r=e.createRenderbuffer(),i=e.createRenderbuffer();if(!n||!r||!i)throw"could not create framebuffer or renderbuffer";this.config=E({color:!0,depth:!0},t),this.framebuffer=n,this.colorbuffer=r,this.depthbuffer=i}activate(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffer),this.config.color&&(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.colorbuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.RGBA8,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.RENDERBUFFER,this.colorbuffer)),this.config.depth&&(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthbuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.depthbuffer)),this}deactivate(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null)}},we=G(),xe=()=>z(we),pe=G(),gt=()=>z(pe),Et=e=>{const t=xe();if(!t)return;e.stack.autosize(()=>{e.onResize?.(e.stack);for(const o of t.events.onResize)o()}),performance.now();const n=()=>{e.onBeforeRender?.(),e.clear&&(typeof e.clear=="function"?e.clear(e.stack):e.stack.clear());for(const o of t.events.onResize)o();e.stack.render(),e.onAfterRender?.()},r=De(o=>Ue(o,1e3/120));let i;const s=()=>{if(e.animate){if(e.animate!==!0){let o=Date.now();(!i||o-i>e.animate)&&(n(),i=o)}else n();requestAnimationFrame(s)}};C(()=>{e.animate?setTimeout(s):(C(()=>{r()&&n()}),i=void 0)})},Rt=e=>{const[t,n]=Fe(e,["children"]),r=E({clear:!0,background:[0,0,0,1]},n),i=(()=>{const a=et();return _e(a,n,!1,!1),a})(),s=i.getContext("webgl2"),o={onResize:new Set,onRender:new Set};return R(we.Provider,{value:{canvas:i,events:o,gl:s,get onProgramCreate(){return e.onProgramCreate}},get children(){return R(pe.Provider,{value:{canvas:i,gl:s,onRender:a=>(o.onRender.add(a),()=>o.onRender.delete(a)),onResize:a=>(o.onResize.add(a),()=>o.onResize.delete(a))},get children(){return[w(()=>(()=>{const a=Pe(()=>t.children),c=w(()=>ct(a())),f=w(()=>ft(a()));return Le(()=>{try{const d=new lt({canvas:i,background:r.background,get programs(){return c()}});Et(E(r,{stack:d}))}catch(d){console.error(d)}}),w(f)})()),i]}})}})},wt=e=>{const t=xe();if(!t)throw"no context";const n=E({canvas:t.canvas},e);return()=>new ge(n)},V=new WeakMap,oe=function(e,...t){const n=V.has(e);n||V.set(e,[]);const r=V.get(e),i=new Map,s=w(()=>t.map((a,c)=>{if(typeof a=="function")return a();if(typeof a=="string"){const d=n&&r[c]||i.get(a)||`${a}_${F()}`;return i.has(a)||i.set(a,d),(!n||!r[c])&&(r[c]=d),{name:d,tokenType:"scope"}}const f=n&&r[c]||a.name;return n||(r[c]=f),E(a,{name:f})}).filter(a=>a!==void 0));return{get source(){return pt(e,s())},bind:({gl:a,program:c,addToRenderQueue:f,requestRender:d})=>{a.useProgram(c);const l={gl:a,program:c,addToRenderQueue:f,requestRender:d},v=new Set;s().forEach(h=>{if(!v.has(h.name))switch(v.add(h.name),h.tokenType){case"attribute":return it({token:h,...l});case"sampler2D":case"isampler2D":return st({token:h,...l});case"uniform":return nt({token:h,...l});case"shader":return h.bind(l)}})},tokenType:"shader",template:e,name:"s_"+F()}},xt=e=>{switch(e.tokenType){case"shader":return e.source.parts.variables;case"attribute":return`in ${e.dataType} ${e.name};`;case"uniform":case"sampler2D":return`uniform ${e.dataType} ${e.name};`;case"isampler2D":return`uniform highp ${e.dataType} ${e.name};`}},pt=(e,t)=>{const n=[...e.flatMap((f,d)=>{const l=t[d];return l&&l.tokenType==="shader"?[f,l.source.parts.body]:!l||!("name"in l)?f:[f,l.name]})].join(""),r=Array.from(new Set(t.flatMap(xt))).join(`
`),i=n.match(/precision.*;/)?.[0];if(i){const[f,d]=n.split(/precision.*;/);return{code:[f,i,r,d].join(`
`),parts:{version:f,precision:i,variables:r,body:d}}}const s=n.match(/#version.*/)?.[0],[o,a]=n.split(/#version.*/),c=a||o;return{code:[s,r,c].join(`
`),parts:{version:s,variables:r,body:c}}},be=(e,t)=>(t.position&&Oe(e,e,t.position),t.rotation&&(q(e,e,t.rotation[0],[1,0,0]),q(e,e,t.rotation[1],[0,1,0]),q(e,e,t.rotation[2],[0,0,1])),t.scale&&qe(e,e,t.scale),e),ee=G(),_=()=>z(ee),Lt=e=>{const[t,n]=T(p(),{equals:!1}),[r,i]=T(p(),{equals:!1}),s=p(),o=p(),a=p();return R(Rt,E(e,{get children(){return(()=>{const c=gt();if(!c)throw"signalgl is undefined";return R(ee.Provider,{get value(){return E(c,{projection:{uniform:S.mat4(t),get matrix(){return t()},get invertedMatrix(){return N(o,t())}},view:{uniform:S.mat4(r),get matrix(){return r()},get invertedMatrix(){return N(a,r())}},model:{uniform:S.mat4(s),matrix:s},setView:i,setProjection:n})},get children(){return e.children}})})()}}))},te=e=>{const t=_();if(!t)throw"scene was not defined";const n=w(()=>e.matrix?e.matrix:be(Xe(t.model.matrix),e));return R(ee.Provider,{get value(){return E(t,{model:{uniform:S.mat4(n),get matrix(){return n()}}})},get children(){return e.children}})},bt=e=>R(te,E(e,{get children(){return[w(()=>e.children),w(()=>(()=>{const t=_();if(!t)throw"scene not defined";return R(wt,{get vertex(){return e.vertex||oe`#version 300 es
          precision mediump float;
          out vec4 model;
          out vec4 view;
          out vec4 clip;
          void main(void) {
            model = ${t.model.uniform} * vec4(${ot.vec3(e.vertices)}, 1.);
            view = ${t.view.uniform} * model;
            clip = ${t.projection.uniform} * view;
            gl_Position = clip;
          }`},get fragment(){return e.fragment||oe`#version 300 es
          precision mediump float;
          out vec4 color_out;
          void main(void) {
            color_out = vec4(${S.vec3(()=>e.color||[0,0,0])}, ${S.float(()=>e.opacity)});
          }`},get mode(){return e.mode||"TRIANGLES"},get indices(){return e.indices},cacheEnabled:!0})})())]}})),Tt=e=>{const t=E({vertices:new Float32Array([-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5]),indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],color:[1,1,1],opacity:1,mode:"TRIANGLES"},e);return R(bt,t)},Ct=e=>{const t=_();if(!t)throw"scene is undefined";const n=p(),r=p(),i=E({fov:45,near:.1,far:1e4},e),s=()=>{e.active&&t.setProjection(He(n,i.fov*Math.PI/180,t.canvas.clientWidth/t.canvas.clientHeight,i.near,i.far))};return C(()=>{e.active&&(window.addEventListener("resize",s),s(),Z(()=>window.removeEventListener("resize",s)))}),C(()=>{e.active&&(Ge(r),U(r,t.model.matrix,be(r,e)),e.matrix&&U(r,r,e.matrix),N(r,r),e.realMatrix&&U(r,r,e.realMatrix),t.setView(r))}),R(te,e)},Bt=e=>{const t=E({target:[0,0,0],up:[0,1,0],near:0,far:50},e),[n,r]=T([0,0],{equals:!1}),[i,s]=T(10),o=p(),a=()=>{const[l,v]=n(),h=[i()*Math.sin(l)*Math.cos(v),i()*Math.sin(v),i()*Math.cos(l)*Math.cos(v)],u=t.target;return We(o,h,u,[0,1,0]),o};let c;const f=l=>{c={x:l.clientX,y:l.clientY};const v=u=>window.removeEventListener("mousemove",h),h=u=>{const g={x:u.clientX,y:u.clientY},m={x:c.x-g.x,y:c.y-g.y};c=g,r(x=>[x[0]+m.x/200,x[1]-m.y/200])};window.addEventListener("mousemove",h),window.addEventListener("mouseup",v)};window.addEventListener("mousedown",f);const d=l=>{s(v=>Math.min(t.far,Math.max(t.near,v+l.deltaY/10))),l.preventDefault()};return window.addEventListener("wheel",d,{passive:!1}),Z(()=>{window.removeEventListener("mousedown",f),window.removeEventListener("wheel",d)}),{get realMatrix(){return a()}}},Dt=()=>{const e=_();if(!e)throw"scene is undefined";const[t,n]=T([0,0,6],{equals:!1}),[r,i]=T(M(),{equals:!1}),[s,o]=Ne({});let a=w(()=>Object.values(s).find(d=>d)),c;{const l=b(),v=b(),h=b(),u=b(),g={x:0,y:0},m=M(),x=M(),$=M(),Te=[1,0,0],ye=[0,1,0],re=.0125,ne=y=>{Ce(()=>{if(a()){if(c){const B=y-c;n(O=>(D(l,0,0,-1),H(l,l,r()),D(v,1,0,0),H(v,v,r()),D(h,-1,0,0),H(h,h,r()),D(u,0,0,0),s.KeyW&&L(u,u,l),s.KeyS&&ie(u,u,l),s.KeyA&&ie(u,u,v),s.KeyD&&L(u,u,v),I(u,u),Ve(u,u,.05*B/10),L(O,O,u),O))}c=y}else c=void 0;i(B=>(W(x),J(x,Te,-g.y*re),W($),J($,ye,-g.x*re),W(m),j(m,$,m),j(m,m,x),k(m,m),j(B,B,m)))}),requestAnimationFrame(ne)};requestAnimationFrame(ne),document.addEventListener("mousemove",y=>{g.x=y.clientX/e.canvas.width-.5,g.y=y.clientY/e.canvas.height-.5}),document.addEventListener("keydown",y=>o(y.code,!0)),document.addEventListener("keyup",y=>o(y.code,!1))}const f=p();return{get matrix(){return Ie(f,r(),t())}}},Ut=e=>{const[t]=Ae(()=>fetch(e).then(r=>r.text()));return w(()=>{const r=t();if(!r)return;const i={vertices:[],indices:[]};return r.split(`
`).forEach(s=>{const[o,...a]=s.split(" "),c=a.map(f=>+f);switch(o){case"v":return i.vertices.push(...c);case"f":return i.indices.push(...c.map(f=>f-1))}}),{vertices:new Float32Array(i.vertices),indices:i.indices}})};export{Pt as A,Ct as C,te as G,Lt as S,Tt as a,bt as b,_t as c,Ft as d,Dt as f,Ut as l,Bt as o};
